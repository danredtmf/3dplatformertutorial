# 3D –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ—Ä

> –ß–∞—Å—Ç—å –≤—Ç–æ—Ä–∞—è

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [1. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–≥—Ä—ã: —É—á—ë—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤](#1-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å-–∏–≥—Ä—ã-—É—á—ë—Ç-—Å–æ–±—Ä–∞–Ω–Ω—ã—Ö-–ø—Ä–µ–¥–º–µ—Ç–æ–≤)
  - [1.1. –ö–æ–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞](#11-–∫–æ–¥-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
- [2. –ë–∞—Ç—É—Ç—ã](#2-–±–∞—Ç—É—Ç—ã)
  - [2.1. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–∞—Ç—É—Ç–∞](#21-—Å–æ–∑–¥–∞–Ω–∏–µ-–æ—Å–Ω–æ–≤–Ω–æ–≥–æ-–±–∞—Ç—É—Ç–∞)
  - [2.2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –∏–≥—Ä–æ–∫–∞](#22-–∏–∑–º–µ–Ω–µ–Ω–∏–µ-–∫–æ–¥–∞-–∏–≥—Ä–æ–∫–∞)
  - [2.3. –ö–æ–¥ –±–∞—Ç—É—Ç–∞](#23-–∫–æ–¥-–±–∞—Ç—É—Ç–∞)
- [3. –ü–æ—Ä—Ç–∞–ª](#3-–ø–æ—Ä—Ç–∞–ª)
  - [3.1. –ö–æ–¥ –ø–æ—Ä—Ç–∞–ª–∞](#31-–∫–æ–¥-–ø–æ—Ä—Ç–∞–ª–∞)

## 1. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–≥—Ä—ã: —É—á—ë—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

–î–ª—è –Ω–∞—á–∞–ª–∞ –≤—Å–ø–æ–º–Ω–∏–º, —á—Ç–æ —É—á—ë—Ç–æ–º —Å–æ–±–∏—Ä–∞–µ–º—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç `CItemsCounter`. –¢–∞–∫ –∫–∞–∫ –Ω–∞–º —Å–∫–æ—Ä–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–∫–∞—Ç—å –µ–≥–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ —á–µ—Ä–µ–∑ –∫–æ–¥, –Ω—É–∂–Ω–æ –æ–±–ª–µ–≥—á–∏—Ç—å –±—É–¥—É—â–∏–π –ø–æ–∏—Å–∫, –¥–æ–±–∞–≤–∏–≤ –æ–±—ä–µ–∫—Ç `CItemsCounter` –≤ –≥—Ä—É–ø–ø—É `CItemsCounter`.

–ó–∞–π–¥–∏—Ç–µ –Ω–∞ —Å—Ü–µ–Ω—É –¥–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ –∏ –≤–æ –≤–∫–ª–∞–¥–∫–µ `Node` –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ `Groups` –∏ —á–µ—Ä–µ–∑ —Å–∏–º–≤–æ–ª `+` –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ –≥—Ä—É–ø–ø—É `CItemsCounter`.

–¢–µ–ø–µ—Ä—å –Ω–∞—á–Ω—ë–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É—á—ë—Ç–∞ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤.

–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–µ–π:

- `CItemsCounterUI` (—Ç–∏–ø `Control`)
  - `Margin` (—Ç–∏–ø `MarginContainer`; —Ä–∞—Å—Ç—è–Ω–∏—Ç–µ —É–∑–µ–ª —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∏—Å—É–Ω–∫—É 1 –Ω–∏–∂–µ; –≤–∫–ª–∞–¥–∫–∞ `Theme Overrides` ‚û°Ô∏è –≤–∫–ª–∞–¥–∫–∞ `Constants`: `Margin Left` / `Margin Top` / `Margin Right` / `Margin Bottom`: `10`)
    - `BoxContainer` (`Vertical`: `true`)
      - `Info` (—Ç–∏–ø `Label`; `Text` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): `–ü—Ä–µ–¥–º–µ—Ç—ã: 0 / 0`)

<div style="text-align: center;"><img src="./images/1.png" alt="–†–∏—Å—É–Ω–æ–∫ 1 ‚Äì –í—ã–±–æ—Ä –ø—Ä–µ—Å–µ—Ç–∞ —è–∫–æ—Ä–µ–π"></div>
<p align="center">–†–∏—Å—É–Ω–æ–∫ 1 ‚Äì –í—ã–±–æ—Ä –ø—Ä–µ—Å–µ—Ç–∞ —è–∫–æ—Ä–µ–π</p>

–°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ü–µ–Ω—É –≤ –ø–∞–ø–∫–µ `objects` ‚û°Ô∏è `c_items_counter_ui`, –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å—Ü–µ–Ω—ã `c_items_counter_ui.tscn`.

### 1.1. –ö–æ–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

–õ–∏—Å—Ç–∏–Ω–≥ –∫–æ–¥–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

```gdscript
class_name CItemsCounterUI extends Control

var counter: CItemsCounter

@onready var info: Label = $Margin/BoxContainer/Info

func _ready() -> void:
	var first_in_group = get_tree().get_first_node_in_group("CItemsCounter")
	if first_in_group != null:
		counter = first_in_group

func _process(delta: float) -> void:
	if counter != null:
		info.text = "–ü—Ä–µ–¥–º–µ—Ç–æ–≤: %s / %s" % [counter.items_count, counter.items_max]
```

> üóíÔ∏è **–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ!**
> 
> –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã –¥–æ–±–∞–≤–∏—Ç–µ –¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –Ω–∞ —É—Ä–æ–≤–µ–Ω—å, —É –∏–≥—Ä–æ–∫–∞ –ø—Ä–æ–ø–∞–¥—ë—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—Ä–∞—â–µ–Ω–∏—è –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –º—ã—à–∏. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ —É –Ω–∞—Å –≤ –∫–æ–¥–µ –∏–≥—Ä–æ–∫–∞ –ª–æ–≥–∏–∫–∞ –≤—Ä–∞—â–µ–Ω–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `_unhandled_input` (–Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –≤–≤–æ–¥). –¢–∞–∫ –∫–∞–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ—è–≤–∏–ª—Å—è –ø–µ—Ä–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —É–∑–ª—ã —Ç–∏–ø–∞ `Control` –∏ –µ–≥–æ –Ω–∞—Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –≤–≤–æ–¥ –º—ã—à–∏, –∞ –¥–æ –µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –≤–≤–æ–¥ –º—ã—à–∏, –±–ª–∞–≥–æ–¥–∞—Ä—è —á–µ–º—É –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ `_unhandled_input` —è–≤–ª—è–ª–∞—Å—å –≤–æ–∑–º–æ–∂–Ω—ã–º. –ß—Ç–æ–±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ, –ø—Ä–æ—Å—Ç–æ –∏–∑–º–µ–Ω–∏—Ç–µ –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏ —Å `_unhandled_input` –Ω–∞ `_input` –∏ –≤—Ä–∞—â–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è.

## 2. –ë–∞—Ç—É—Ç—ã

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

### 2.1. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–∞—Ç—É—Ç–∞

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–µ–π:

- `JumpHelperBase` (—Ç–∏–ø `Area3D`)
  - `MeshFront` (—Ç–∏–ø `MeshInstance3D`; `Mesh`: `BoxMesh` ‚û°Ô∏è `Size`: `(x: 2, y: 2, z: 2)`; –≤–∫–ª–∞–¥–∫–∞ `Surface Material Override` ‚û°Ô∏è —Å–æ–∑–¥–∞–π—Ç–µ `StandartMaterial3D`: –≤–∫–ª–∞–¥–∫–∞ `Transparency` ‚û°Ô∏è `Transparency`: `Alpha`, –≤–∫–ª–∞–¥–∫–∞ `Albedo` ‚û°Ô∏è `Color`: `ffffff80`)
  - `MeshBack` (—Ç–∏–ø `MeshInstance3D`; `Mesh`: `BoxMesh` ‚û°Ô∏è `Size`: `(x: 1.5, y: 1.5, z: 1.5)`; –≤–∫–ª–∞–¥–∫–∞ `Surface Material Override` ‚û°Ô∏è —Å–æ–∑–¥–∞–π—Ç–µ `StandartMaterial3D`)
  - `Shape` (—Ç–∏–ø `CollisionShape3D`; `Shape`: `BoxShape3D`: `Size`: `(x: 2.1, y: 2.1, z: 2.1)`)

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–ª–∏–∑–∏—é —É –¥–∞–Ω–Ω–æ–≥–æ –±–∞—Ç—É—Ç–∞, –Ω–∞–∂–∏–º–∞–µ–º –Ω–∞ —É–∑–µ–ª `MeshFront` –∏ –≤—ã–ø–æ–ª—è–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π, –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–∏—Å—É–Ω–∫–µ 2.

<div style="text-align: center;"><img src="./images/2.png" alt="–†–∏—Å—É–Ω–æ–∫ 2 ‚Äì –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–∏–∑–∏–∏ —É –º–µ—à–∞"></div>
<p align="center">–†–∏—Å—É–Ω–æ–∫ 2 ‚Äì –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–∏–∑–∏–∏ —É –º–µ—à–∞</p>

–°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ü–µ–Ω—É –≤ –ø–∞–ø–∫–µ `objects` ‚û°Ô∏è `jump_helper_base`, –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å—Ü–µ–Ω—ã `jump_helper_base.tscn`.

### 2.2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –∏–≥—Ä–æ–∫–∞

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

–ü—Ä–µ–∂–¥–µ —á–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å –∫–æ–¥ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –±–∞—Ç—É—Ç—É, –ø—Ä–µ–¥–ª–∞–≥–∞—é –¥–æ–ø–æ–ª–Ω–∏—Ç—å –∫–æ–¥ –∏–≥—Ä–æ–∫–∞. –£—á–∏—Ç—ã–≤–∞–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å—Ç—Ä–æ–∫–∞–º –∫–æ–¥–∞, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º –≤ –ª–∏—Å—Ç–∏–Ω–≥. –ë—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—á—ë—Ç—ã –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∏ –≤—Ä–∞—â–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–∞.

–õ–∏—Å—Ç–∏–Ω–≥ –∫–æ–¥–∞:

```gdscript
# –î–æ–±–∞–≤—å—Ç–µ –∫ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º
const JUMP_MOD_DEFAULT := 1.0

# –î–æ–±–∞–≤—å—Ç–µ –∫ –æ–±—ã—á–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º
var is_jump_modified := false
var jump_mod := JUMP_MOD_DEFAULT

func _physics_process(delta: float) -> void:
	# –ö–æ–¥ –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏
	...
	# –ó–∞–º–µ–Ω–∏—Ç–µ –∫–æ–¥ –ü—Ä—ã–∂–∫–∞
	if Input.is_action_pressed("ui_accept") and is_on_floor():
		if is_jump_modified:
			velocity.y = JUMP_VELOCITY * jump_mod
		else:
			velocity.y = JUMP_VELOCITY
  ...
  # –î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–≤ —ç—Ç–æ–π —Å—Ç—Ä–æ—á–∫–µ –Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–æ)
	var input_dir := Input.get_vector("left", "right", "forward", "backward")
	# —É–±—Ä–∞–Ω `head` –≤ `transform.basis`
	var direction := (transform.basis * Vector3(input_dir.x, 0, input_dir.y)).normalized()
  ...

# –ü–µ—Ä–µ—Ö–≤–∞—Ç —Ä–∞–Ω–µ–µ –Ω–µ–ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã—Ö –≤–≤–æ–¥–æ–≤
func _input(event: InputEvent) -> void:
	if event is InputEventMouseMotion:
		# —É–±—Ä–∞–Ω `head` –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏
		rotate_y(-event.relative.x * sensitivity)
		# –∑–∞–º–µ–Ω–∞ `camera` –Ω–∞ `head`
		head.rotate_x(-event.relative.y * sensitivity)
		head.rotation.x = clamp(head.rotation.x, deg_to_rad(-head_angle), deg_to_rad(head_angle))
```

### 2.3. –ö–æ–¥ –±–∞—Ç—É—Ç–∞

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

–õ–∏—Å—Ç–∏–Ω–≥ –∫–æ–¥–∞ –±–∞—Ç—É—Ç–∞:

```gdscript
# @tool –¥–∞—ë—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
# –ò–°–ü–û–õ–¨–ó–£–ô–¢–ï –û–°–¢–û–†–û–ñ–ù–û!
# –†–µ–∫–æ–º–µ–Ω–¥—É—é –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –≤ –∫–æ–Ω—Ü–µ —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ —Å–∫—Ä–∏–ø—Ç–æ–º
@tool
class_name JumpHelperBase extends Area3D

# @export_range - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–∏–∞–ø–æ–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π —É –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
@export_range(1.0, 100.0) var jump_mod := 1.0
@export var color: Color = Color.WHITE

@onready var mesh_front: MeshInstance3D = $MeshFront
@onready var mesh_back: MeshInstance3D = $MeshBack

var mesh_front_material: StandardMaterial3D
var mesh_back_material: StandardMaterial3D

func _ready() -> void:
	check_materials()
	get_meshes_color()

func _process(_delta: float) -> void:
	# –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
	if Engine.is_editor_hint():
		get_meshes_color()

# –ï—Å–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
func check_materials(fallback_return: bool = false) -> void:
	if mesh_front_material == null or mesh_back_material == null:
		mesh_front_material = mesh_front.get_surface_override_material(0).duplicate() as StandardMaterial3D
		mesh_back_material = mesh_back.get_surface_override_material(0).duplicate() as StandardMaterial3D
		mesh_front.set_surface_override_material(0, mesh_front_material)
		mesh_back.set_surface_override_material(0, mesh_back_material)
		return

func get_meshes_color() -> void:
	check_materials(true)
	
	# –£–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
	if mesh_front_material.albedo_color.r == color.r and \
		mesh_front_material.albedo_color.g == color.g and \
		mesh_front_material.albedo_color.b == color.b and \
		mesh_back_material.albedo_color.r == color.r and \
		mesh_back_material.albedo_color.g == color.g and \
		mesh_back_material.albedo_color.b == color.b:
			return
	
	mesh_front_material.albedo_color.r = color.r
	mesh_front_material.albedo_color.g = color.g
	mesh_front_material.albedo_color.b = color.b
	
	mesh_back_material.albedo_color.r = color.r
	mesh_back_material.albedo_color.g = color.g
	mesh_back_material.albedo_color.b = color.b

# –ù—É–∂–Ω–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å —Å–∏–≥–Ω–∞–ª "_on_body_entered" —É –æ–±–ª–∞–¥–∞—Ç–µ–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
func _on_body_entered(body: Node3D) -> void:
	if body is Player:
		body.jump_mod = jump_mod
		body.is_jump_modified = true

# –ù—É–∂–Ω–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å —Å–∏–≥–Ω–∞–ª "_on_body_exited" —É –æ–±–ª–∞–¥–∞—Ç–µ–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
func _on_body_exited(body: Node3D) -> void:
	if body is Player:
		body.is_jump_modified = false
```

## 3. –ü–æ—Ä—Ç–∞–ª

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

–°–æ–∑–¥–∞–¥–∏–º –ø–æ—Ä—Ç–∞–ª, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–µ—Ä–µ–º–µ—â–∞—Ç—å –∏–≥—Ä–æ–∫–∞ –∫ –¥—Ä—É–≥–æ–º—É –ø–æ—Ä—Ç–∞–ª—É –∏ —Å–¥–µ–ª–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Ä—Ç–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–≥—Ä–æ–∫–æ–º –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.

–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–µ–π:

- `Portal` (—Ç–∏–ø `Area3D`)
  - `Mesh` (—Ç–∏–ø `MeshInstance3D`; `Mesh`: `BoxMesh` ‚û°Ô∏è `Size`: `(x: 0.1, y: 2, z: 1)`; –≤–∫–ª–∞–¥–∫–∞ `Surface Material Override` ‚û°Ô∏è —Å–æ–∑–¥–∞–π—Ç–µ `StandartMaterial3D`: –≤–∫–ª–∞–¥–∫–∞ `Albedo` ‚û°Ô∏è `Color`: `009500`)
  - `Shape` (—Ç–∏–ø `CollisionShape3D`; `Shape`: `BoxShape3D`: `Size`: `(x: 0.2, y: 2.1, z: 1.1)`)
  - `ForwardPos` (—Ç–∏–ø `Marker3D`; –≤–∫–ª–∞–¥–∫–∞ `Transform` ‚û°Ô∏è `Position`: `(x: 1, y: 0, z: 0)`)
  - `ForwardLookPos` (—Ç–∏–ø `Marker3D`; –≤–∫–ª–∞–¥–∫–∞ `Transform` ‚û°Ô∏è `Position`: `(x: 2, y: 0, z: 0)`)

–°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ü–µ–Ω—É –≤ –ø–∞–ø–∫–µ `objects` ‚û°Ô∏è `portal`, –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å—Ü–µ–Ω—ã `portal.tscn`.

### 3.1. –ö–æ–¥ –ø–æ—Ä—Ç–∞–ª–∞

[–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)

–õ–∏—Å—Ç–∏–Ω–≥ –∫–æ–¥–∞ –ø–æ—Ä—Ç–∞–ª–∞:

```gdscript
class_name Portal extends Area3D

@export var is_end: bool
@export var is_touchable: bool = true
@export var next_portal: Portal
@export var next_level: PackedScene

var c_items_counter: CItemsCounter

@onready var forward_pos: Marker3D = $ForwardPos
@onready var forward_look_pos: Marker3D = $ForwardLookPos

func _ready() -> void:
	if not is_end:
		set_process(false)
	else:
		var c_items_counter_find = get_tree().get_first_node_in_group("CItemsCounter")
		if c_items_counter_find == null:
			set_process(false)
			print("–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ—Ä—Ç–∞–ª: \"–ù–∏–∫—Ç–æ –Ω–µ —Å—á–∏—Ç–∞–µ—Ç –ø—Ä–µ–¥–º–µ—Ç—ã... –Ω—É –∏ –ª–∞–¥–Ω–æ\"")
		else:
			c_items_counter = c_items_counter_find
			is_touchable = false

func get_global_forward_position() -> Vector3:
	return forward_pos.global_position

func set_player_look_at_forward_position(player: Player) -> void:
	player.look_at(forward_look_pos.global_position)

# –ë—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ—Ä—Ç–∞–ª —è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º –∏ –∏–≥—Ä–æ–∫ –Ω–µ —Å–æ–±—Ä–∞–ª –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã
func _process(_delta: float) -> void:
	if c_items_counter.items_count >= c_items_counter.items_max:
		print("–ü–æ—Ä—Ç–∞–ª —É–≤–∏–¥–µ–ª, —á—Ç–æ –∏–≥—Ä–æ–∫ —Å–æ–±—Ä–∞–ª –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏ –æ–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª—Å—è!")
		is_touchable = true
		set_process(false)

# –ù—É–∂–Ω–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å —Å–∏–≥–Ω–∞–ª "_on_body_entered" —É –æ–±–ª–∞–¥–∞—Ç–µ–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
func _on_body_entered(body: Node3D) -> void:
	if body is Player and is_touchable:
		if not is_end:
			next_portal.is_touchable = false
			body.global_position = next_portal.get_global_forward_position()
			next_portal.set_player_look_at_forward_position(body)
			await get_tree().create_timer(0.25).timeout
			next_portal.is_touchable = true
		else:
			if next_level:
				get_tree().change_scene_to_packed(next_level)
			else:
				get_tree().quit()
```
